<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/style_2.css">
</head>
<body>
  <!-- â–¼LINEé¢¨ã“ã“ã‹ã‚‰ -->
  <div class="line__container">
    <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
    <div class="line__title">
      ãƒœãƒƒãƒç”¨LINEé¢¨ãƒãƒ£ãƒƒãƒˆ
    </div>
    <div class="message-area">
      <div class="message-area-text">
        <unamearea>
            åå‰ï¼š<select id="uname">
                <option value="è‡ªåˆ†">ã˜ã¶ã‚“</option>
                <option value="ã‚¨ã‚¢å‹é”">ãˆã‚ãƒ•ãƒ¬ãƒ³ã‚º</option>
                </select>
        </unamearea>
        <textarea id="text"></textarea>

    </div>
      <div class="message-area-button">
        <button id="send" class="disabled-button">é€ä¿¡</button>
      </div>
    </div>
    <!-- â–¼ä¼šè©±ã‚¨ãƒªã‚¢ scrollã‚’å¤–ã™ã¨é«˜ã•å›ºå®šè§£é™¤ -->
    <div id="output" class="line__contents scroll">
    </div>
    <!--ã€€â–²ä¼šè©±ã‚¨ãƒªã‚¢ ã“ã“ã¾ã§ -->
  </div>
  <!--ã€€â–²LINEé¢¨ã“ã“ã¾ã§ -->
<!--ã€€â–²LINEé¢¨ã“ã“ã¾ã§ -->


<!-- JQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!-- JQuery -->


<!--** ä»¥ä¸‹Firebase **-->
<script type="module">
// Import the functions you need from the SDKs you need
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
import {
    getDatabase,
    ref,
    push,
    set,
    onChildAdded,
    remove,
    onChildRemoved,
} from "https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js";
// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "@@@@@@@@@@@@@@@@@@@@",
  authDomain: "@@@@@@@@@@@@@@@@@@@@",
  databaseURL: "@@@@@@@@@@@@@@@@@@@@",
  projectId: "@@@@@@@@@@@@@@@@@@@@",
  storageBucket: "@@@@@@@@@@@@@@@@@@@@",
  messagingSenderId: "@@@@@@@@@@@@@@@@@@@@",
  appId: "@@@@@@@@@@@@@@@@@@@@",
};

const app = initializeApp(firebaseConfig);
const db  = getDatabase(app); //RealtimeDBã«æ¥ç¶š
const dbRef = ref(db,"chat"); //RealtimeDBå†…ã®"chat"ã‚’ä½¿ã†

//é€ä¿¡ã®ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã™ã‚‹å‡¦ç†ã‚’æ›¸ãã¾ã™
$('#send').on('click',function(){
        const unameValue = $("#uname").val();
        const textValue = $("#text").val();

     // ãƒ‡ãƒ¼ã‚¿ã®å¡Šã‚’ä½œæˆ
    const msg = {
        uname: unameValue,
        text: textValue,
    }
    const newPostRef = push(dbRef); //ãƒ¦ãƒ‹ãƒ¼ã‚¯KEYã‚’ç”Ÿæˆ
    set(newPostRef, msg);           //"chat"ã«ãƒ¦ãƒ‹ãƒ¼ã‚¯KEYã‚’ã¤ã‘ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²

    //â˜…å…¥åŠ›æ¬„ã‚’ç©ºã«ã™ã‚‹
    $("#uname").val("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„");//ç©ºã«ã™ã‚‹
    $("#text").val("ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");//ç©ºã«ã™ã‚‹
});

    // å—ä¿¡å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ğŸ¤—
    onChildAdded(dbRef, function (data) {
        const msg = data.val();
        //console.log(msg, "dataã‚’å–å¾—");
        const kagi = data.key
        // console.log(kagi, "éµ");

        let html = "";

        if (msg.uname === "ã‚¨ã‚¢å‹é”") {
        html = `
        <div class=${kagi}>
          <div class="line__left">
            <figure>
              <img src="icon.png" />
            </figure>
            <div class="line__left-text">
              <div class="text">${msg.text}</div>
        </div>
        `;
       }else{
        html = `
        <div class=${kagi}>
          <div class="line__right">
            <div class="line__right-text">
            <div class="text">${msg.text}</div>
            <span class="date">${msg.uname}</span>
        </div>
        `;
       }

          $("#output").append(html);
        });

</script>



</body>
</html>